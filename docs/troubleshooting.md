# 故障排查与限制

## 常见问题排查

### 1. Token 文件权限错误
`teamd` 启动时会检查 `runtime.json` 的权限。如果权限过大（非 0600），可能会导致安全警告或启动失败。
- **解决方法**：`chmod 600 ~/.pi/teams/<teamId>/runtime.json`

### 2. 端口占用
`teamd` 默认监听 4500 端口（或随机端口）。如果端口被占用，启动将失败。
- **解决方法**：使用 `--port <n>` 指定其他端口。

### 3. 单实例锁
每个团队（Team）只能运行一个 `teamd` 实例。如果尝试启动第二个实例，会提示锁文件已存在。
- **解决方法**：检查是否有残留的 `teamd` 进程，或手动删除工作区下的 `.lock` 文件（确保进程已退出）。

### 4. JSONL 损坏
如果系统异常崩溃，`threads/*.jsonl` 可能会出现尾部半行。
- **处理机制**：`pi-team` 的读取库会自动忽略不完整的最后一行，确保系统仍可运行。

## MVP 阶段非目标 (Non-Goals)

为了保持 MVP 版本的简洁和稳定，以下特性暂不支持：

- **跨机器协作**：目前仅支持单机 localhost 协作。
- **实时推送 (Push/SSE/WS)**：目前采用轮询（Polling）机制获取收件箱更新。
- **复杂权限体系 (RBAC)**：目前仅基于 Token 的简单鉴权，不区分细粒度的用户角色权限。
- **自动拉起 Agent**：`pi-team` 仅提供环境配置，不负责自动启动多个终端或 Agent 进程。

## 安全建议

- **仅限本地监听**：`teamd` 默认仅监听 `127.0.0.1`，请勿将其暴露到公网。
- **Token 保护**：`runtime.json` 包含敏感 Token，请确保其权限正确且不被泄露。
